<div class="container-fluid mt-4 px-4">
  <!-- Header -->
  <div class="mb-4">
    <h1 class="display-5 fw-bold text-dark mb-2">Reservations Management</h1>
    <p class="text-muted">Admin Dashboard - Monitor All Platform Reservations</p>
  </div>

  <!-- Stats Cards -->
  <div *ngIf="showStats && stats" class="row g-4 mb-4">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Total Reservations</h6>
              <h2 class="mb-0 fw-bold">{{ stats.totalReservations }}</h2>
            </div>
            <i class="bi bi-calendar-check fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-0 shadow-sm bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Total Revenue</h6>
              <h2 class="mb-0 fw-bold">${{ stats.totalRevenue }}</h2>
            </div>
            <i class="bi bi-cash-stack fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-0 shadow-sm bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Average Price</h6>
              <h2 class="mb-0 fw-bold">${{ stats.averagePrice }}</h2>
            </div>
            <i class="bi bi-graph-up fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card border-0 shadow-sm bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Confirmed</h6>
              <h2 class="mb-0 fw-bold">{{ getStatusCount('confirmed') }}</h2>
            </div>
            <i class="bi bi-check-circle fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Status Overview Cards -->
  <div *ngIf="showStats && stats" class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-clock-history text-warning fs-2"></i>
          <h4 class="mt-2 mb-0">{{ getStatusCount('pending') }}</h4>
          <small class="text-muted">Pending</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-check-circle text-success fs-2"></i>
          <h4 class="mt-2 mb-0">{{ getStatusCount('confirmed') }}</h4>
          <small class="text-muted">Confirmed</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-x-circle text-danger fs-2"></i>
          <h4 class="mt-2 mb-0">{{ getStatusCount('cancelled') }}</h4>
          <small class="text-muted">Cancelled</small>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <i class="bi bi-check2-all text-secondary fs-2"></i>
          <h4 class="mt-2 mb-0">{{ getStatusCount('completed') }}</h4>
          <small class="text-muted">Completed</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <input
            type="text"
            class="form-control"
            placeholder="üîç Search guest, email, hotel..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
          />
        </div>

        <div class="col-md-3">
          <select
            class="form-select"
            [(ngModel)]="filterStatus"
            (ngModelChange)="onStatusChange()"
          >
            <option value="">All Status</option>
            <option *ngFor="let status of statuses" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>
        </div>

        <div class="col-md-2">
          <button
            class="btn btn-secondary w-100"
            (click)="toggleStats()"
          >
            <i class="bi" [ngClass]="showStats ? 'bi-eye-slash' : 'bi-eye'"></i>
            {{ showStats ? 'Hide' : 'Show' }} Stats
          </button>
        </div>

        <div class="col-md-3 text-end">
          <span class="badge bg-light text-dark fs-6 py-2 px-3">
            Showing {{ filteredReservations.length }} of {{ reservations.length }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Table -->
  <div *ngIf="!loading" class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-dark">
            <tr>
              <th class="px-4 py-3">Guest</th>
              <th class="px-4 py-3">Booking</th>
              <th class="px-4 py-3">Check-In</th>
              <th class="px-4 py-3">Check-Out</th>
              <th class="px-4 py-3">Guests</th>
              <th class="px-4 py-3">Total</th>
              <th class="px-4 py-3">Status</th>
              <th class="px-4 py-3 text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let reservation of pagedFilteredReservations; trackBy: trackById">
              <td class="px-4 py-3">
                <strong>{{ reservation.guestName }}</strong><br />
                <small class="text-muted">{{ reservation.guestEmail }}</small>
              </td>
              <td class="px-4 py-3">
                <span *ngIf="reservation.hotelName" class="badge bg-primary-subtle text-primary">
                  üè® {{ reservation.hotelName }}
                </span>
                <span *ngIf="reservation.experienceName" class="badge bg-success-subtle text-success">
                  üé≠ {{ reservation.experienceName }}
                </span>
              </td>
              <td class="px-4 py-3">
                <small>{{ reservation.checkIn }}</small>
              </td>
              <td class="px-4 py-3">
                <small>{{ reservation.checkOut }}</small>
              </td>
              <td class="px-4 py-3 text-center">
                <span class="badge bg-secondary">{{ reservation.guestsCount }}</span>
              </td>
              <td class="px-4 py-3">
                <span class="fw-bold text-success">${{ reservation.totalPrice }}</span>
              </td>
              <td class="px-4 py-3">
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-warning text-dark': reservation.status === 'pending',
                    'bg-success': reservation.status === 'confirmed',
                    'bg-danger': reservation.status === 'cancelled',
                    'bg-secondary': reservation.status === 'completed'
                  }"
                >
                  {{ reservation.status | titlecase }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="d-flex justify-content-center">
                  <button
                    class="btn btn-sm btn-info text-white"
                    (click)="openReservationDetails(reservation)"
                    title="View Details"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredReservations.length === 0">
              <td colspan="8" class="text-center py-5 text-muted">
                <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                No reservations found
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <app-pagination
    [totalItems]="filteredReservations.length"
    [itemsPerPage]="itemsPerPage"
    [currentPage]="currentPage"
    (pageChange)="onPage($event)"
    (itemsPerPageChange)="onItemsPerPageChange($event)"
  ></app-pagination>

  <!-- Modal -->
  <app-reservation-modal
    *ngIf="selectedReservation"
    [reservation]="selectedReservation"
    (closeModal)="closeReservationDetails()"
  >
  </app-reservation-modal>
</div>