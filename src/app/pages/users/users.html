<div class="container-fluid mt-4 px-4">
  <!-- Header -->
  <div class="mb-4">
    <h1 class="display-5 fw-bold text-dark mb-2">Users Management</h1>
    <p class="text-muted">Admin Dashboard - View & Manage Platform Users</p>
  </div>

  <!-- Stats Cards -->
  <div class="row g-4 mb-4">
    <div class="col-md-2">
      <div class="card border-0 shadow-sm bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Total Users</h6>
              <h2 class="mb-0 fw-bold">{{ stats.total }}</h2>
            </div>
            <i class="bi bi-people fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card border-0 shadow-sm bg-success text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Verified</h6>
              <h2 class="mb-0 fw-bold">{{ stats.verified }}</h2>
            </div>
            <i class="bi bi-check-circle fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card border-0 shadow-sm bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Pending</h6>
              <h2 class="mb-0 fw-bold">{{ stats.pending }}</h2>
            </div>
            <i class="bi bi-clock-history fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card border-0 shadow-sm bg-danger text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Rejected</h6>
              <h2 class="mb-0 fw-bold">{{ stats.rejected }}</h2>
            </div>
            <i class="bi bi-x-circle fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card border-0 shadow-sm bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Hosts</h6>
              <h2 class="mb-0 fw-bold">{{ stats.hosts }}</h2>
            </div>
            <i class="bi bi-house-door fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-2">
      <div class="card border-0 shadow-sm bg-dark text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">Guests</h6>
              <h2 class="mb-0 fw-bold">{{ stats.guests }}</h2>
            </div>
            <i class="bi bi-person fs-1 opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <input
            type="text"
            class="form-control"
            placeholder="ðŸ” Search users by name or email..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
          />
        </div>

        <div class="col-md-3">
          <select
            class="form-select"
            [(ngModel)]="filterStatus"
            (ngModelChange)="onStatusChange()"
          >
            <option value="">All Statuses</option>
            <option value="verified">Verified</option>
            <option value="pending">Pending</option>
            <option value="rejected">Rejected</option>
            <option value="notVerified">Not Verified</option>
          </select>
        </div>

        <div class="col-md-2">
          <select
            class="form-select"
            [(ngModel)]="filterRole"
            (ngModelChange)="onRoleChange()"
          >
            <option value="">All Roles</option>
            <option value="host">Host</option>
            <option value="guest">Guest</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div class="col-md-3 text-end">
          <span class="badge bg-light text-dark fs-6 py-2 px-3">
            Showing {{ filteredUsers.length }} of {{ users.length }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Table -->
  <div *ngIf="!loading" class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-dark">
            <tr>
              <th class="px-4 py-3">Image</th>
              <th class="px-4 py-3">Name</th>
              <th class="px-4 py-3">Email</th>
              <th class="px-4 py-3">Phone</th>
              <th class="px-4 py-3">Role</th>
              <th class="px-4 py-3">Status</th>
              <th class="px-4 py-3 text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers; trackBy: trackById">
              <td class="px-4 py-3">
                <img
                  [src]="user.image || 'https://via.placeholder.com/80'"
                  width="60"
                  height="60"
                  class="rounded-circle shadow-sm object-fit-cover"
                  alt="User"
                />
              </td>
              <td class="px-4 py-3 fw-semibold">{{ user.name }}</td>
              <td class="px-4 py-3">
                <i class="bi bi-envelope text-primary me-1"></i>
                {{ user.email }}
              </td>
              <td class="px-4 py-3">
                <i class="bi bi-telephone text-success me-1"></i>
                {{ user.phone || 'N/A' }}
              </td>
              <td class="px-4 py-3">
                <span class="badge bg-secondary me-1" *ngFor="let role of user.role">
                  {{ role }}
                </span>
              </td>
              <td class="px-4 py-3">
                <span 
                  class="badge"
                  [ngClass]="getStatusBadgeClass(user.isVerified)"
                >
                  {{ user.isVerified === 'verified' ? 'Verified' :
                     user.isVerified === 'pending' ? 'Pending' :
                     user.isVerified === 'rejected' ? 'Rejected' :
                     'Not Verified' }}
                </span>
              </td>
              <td class="px-4 py-3">
                <div class="d-flex justify-content-center gap-2">
                  <button
                    class="btn btn-sm btn-info text-white"
                    (click)="openUserModal(user)"
                    title="View Details"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredUsers.length === 0">
              <td colspan="7" class="text-center py-5 text-muted">
                <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                No users found
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <app-user-modal
    *ngIf="selectedUser"
    [user]="selectedUser"
    [hotels]="hostHotels"
    [experiences]="hostExperiences"
    (closeModal)="closeUserModal()"
    (verifyUser)="onVerifyUser($event)"
    (rejectUser)="onRejectUser($event)"
  ></app-user-modal>
</div>